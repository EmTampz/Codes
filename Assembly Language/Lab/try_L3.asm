	.ORIG x3000
	JSR MULT1
	HALT

MULT1	ST R0, SAVEREG0
	ST R1, SAVEREG1
	ST R2, SAVEREG2
	ST R3, SAVEREG3
	ST R4, SAVEREG4
	ST R5, SAVEREG5
	ST R6, SAVEREG6
	ST R7, SAVEREG7

	AND R7, R7, #0
	ADD R7, R7, #1
	LDI R0, X
	ADD R0, R0, #0
	BRzp POS
	ADD R7, R7, #-1
	NOT R0, R0
	ADD R0, R0, #1

POS	LDI R1, Y
	ADD R1, R1, #0
	BRzp POS2
	ADD R7, R7, #-1
	NOT R1, R1
	ADD R1, R1, #1

POS2	AND R2, R2, #0
	AND R4, R4, #0
	AND R5, R5, #0
	ADD R4, R4, #15
	ADD R2, R2, x1
	ADD R6, R1, #0

LOOP	AND R3, R6, R2
	BRz ISZERO
	ADD R5, R5, R0

ISZERO	ADD R2, R2, R2
	ADD R0, R0, R0
	ADD R4, R4, #-1
	BRp LOOP
	ADD R7, R7, #0
	BRnp NOTZERO
	NOT R5, R5
	ADD R5, R5, #1

NOTZERO	STI R5, P
	LD R0, SAVEREG0
	LD R1, SAVEREG1
	LD R2, SAVEREG2
	LD R3, SAVEREG3
	LD R4, SAVEREG4
	LD R5, SAVEREG5
	LD R6, SAVEREG6
	LD R7, SAVEREG7
	RET

SAVEREG0 .FILL x0
SAVEREG1 .FILL x1
SAVEREG2 .FILL x2
SAVEREG3 .FILL x3
SAVEREG4 .FILL x4
SAVEREG5 .FILL x5
SAVEREG6 .FILL x6
SAVEREG7 .FILL x7
X	 .FILL x3100
Y	 .FILL x3101
P	 .FILL x3102
	 .END



